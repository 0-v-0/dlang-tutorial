# 函数指针与委托

## 函数指针

函数指针是指向函数的指针类型。它可以用来存储函数的地址，并且可以通过函数指针调用函数。

### 定义函数指针

在D语言中，使用以下语法定义函数指针：

```d
返回类型 function(参数列表) 变量名
```

其中，返回类型是函数的返回类型，指针变量名是函数指针的名称，参数列表是函数的参数列表。

例如，下面是一个定义函数指针的示例：

```d
int function(int, int) fp;

alias A = int(int a, int b); // A为函数声明
alias B = int function(int a, int b); // B为函数指针
```

在上面的示例中，fp可以指向返回类型为int，参数列表为两个int类型的函数。

### 使用函数指针

下面是一个使用函数指针的示例：

```d
int add(int a, int b) {
    return a + b;
}

int function(int a, int b) fp = &add; // 将函数的地址赋值给函数指针

int result = fp(1, 2); // 通过函数指针调用函数
writeln(result); // 输出：3
```

## 委托

委托是一种特殊的函数指针，它可以指向不同类型的函数，并且可以在运行时动态地改变指向的函数。

### 定义委托

定义委托与定义函数指针相似，唯一区别是将function关键字改为delegate

下面是一个定义委托的示例：

```d
int delegate(int a, int b) dg;
```

## lambda表达式

lambda表达式是一种匿名函数，它既可以是函数类型也可以是委托类型，取决于是否引用外部变量。

## 闭包

闭包（closure）是指一个函数在离开作用域后仍可访问的作用域中的变量。

在D语言中，闭包只会出现在一个访问了外部变量的委托中。

例如，下面是一个使用闭包的示例：

```d
int a = 1;

auto closure = () {
    return a + 1;
};
```

如果一个委托引用了比它生命周期更短的变量，则需要在堆上创建这些变量的副本，这通常需要GC。例如上述示例中，若a位于栈上，当a所在函数返回时a会被销毁，
因此在委托创建时应该将a复制到堆上。
